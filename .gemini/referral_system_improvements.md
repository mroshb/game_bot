# ุณุณุชู ุฏุนูุช ุงุฒ ุฏูุณุชุงู (Referral System)

## ุชุบุฑุงุช ุงูุฌุงู ุดุฏู

### 1. ุจูุจูุฏ ุณุณุชู ูพุงุฏุงุดโุฏู

#### ูุจู:
- ููุท ตฐ ุณฺฉู ุจู ูุฑ ุฏู ุทุฑู ุฏุงุฏู ูโุดุฏ
- ูพุงู ฺฏูุฑุงูโฺฉููุฏู ุฏุฑุจุงุฑู "ฒฐูช ุงุฒ ุงููู ุฎุฑุฏ"
- ุจุฏูู ุงุทูุงุนโุฑุณุงู ุจู ุฏุนูุชโฺฉููุฏู

#### ุจุนุฏ:
- **ุฏุนูุชโฺฉููุฏู**: ฑฐฐ ุณฺฉู ุฏุฑุงูุช ูโฺฉูุฏ
- **ุฏุนูุชโุดููุฏู**: ตฐ ุณฺฉู ุฏุฑุงูุช ูโฺฉูุฏ
- ุงุทูุงุนโุฑุณุงู ููุฑ ุจู ุฏุนูุชโฺฉููุฏู ุจุง ุฌุฒุฆุงุช ฺฉุงูู
- ูพุงู ุฎูุดโุขูุฏฺฏู ุจูุจูุฏ ุงูุชู ุจุฑุง ฺฉุงุฑุจุฑ ุฌุฏุฏ

### 2. ุฑุฏุงุจ ู ุขูุงุฑ ุฏุนูุชโูุง

#### ุชูุงุจุน ุฌุฏุฏ ุฏุฑ `UserRepository`:
```go
// GetReferralCount - ุดูุงุฑุด ุชุนุฏุงุฏ ุฏุนูุชโูุง ูููู
func (r *UserRepository) GetReferralCount(userID uint) (int64, error)

// GetReferredUsers - ูุณุช ฺฉุงุฑุจุฑุงู ุฏุนูุชโุดุฏู
func (r *UserRepository) GetReferredUsers(userID uint, limit int) ([]models.User, error)
```

### 3. ููุงุด ุขูุงุฑ ุฏุฑ ุฏฺฉูู ุฏุนูุช

ููุช ฺฉุงุฑุจุฑ ุฑู ุฏฺฉูู "๐ฃ ุฏุนูุช ุงุฒ ุฏูุณุชุงู" ฺฉูฺฉ ูโฺฉูุฏุ ุงุทูุงุนุงุช ุฒุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ:

```
๐ฃ ูุนุฑู ุจู ุฏูุณุชุงู:

ุจุง ุฏุนูุช ุงุฒ ุฏูุณุชุงู ุฎูุฏุ ูุฑ ุฏู ููุฑ ุฌุงุฒู ุฏุฑุงูุช ูโฺฉูุฏ!

๐ ูพุงุฏุงุดโูุง:
โข ุดูุง: ฑฐฐ ุณฺฉู ุจุฑุง ูุฑ ุฏุนูุช
โข ุฏูุณุช ุดูุง: ตฐ ุณฺฉู ูุฏู ูุฑูุฏ

๐ ุขูุงุฑ ุฏุนูุชโูุง ุดูุง:
๐ฅ ุชุนุฏุงุฏ ุฏุนูุชโูุง: X ููุฑ
๐ฐ ฺฉู ูพุงุฏุงุด ุฏุฑุงูุช: X ุณฺฉู

๐ ููฺฉ ุฏุนูุช ุงุฎุชุตุงุต ุดูุง:
https://t.me/bot_name?start=ref_USERID
```

### 4. ุงุทูุงุนโุฑุณุงู ุจู ุฏุนูุชโฺฉููุฏู

ููุช ฺฉุณ ุจุง ููฺฉ ุฏุนูุช ุซุจุชโูุงู ูโฺฉูุฏุ ุฏุนูุชโฺฉููุฏู ูพุงู ุฒุฑ ุฑุง ุฏุฑุงูุช ูโฺฉูุฏ:

```
๐ ุชุจุฑฺฉ! [ูุงู ฺฉุงุฑุจุฑ] ุจุง ููฺฉ ุฏุนูุช ุดูุง ูุงุฑุฏ ุจุงุฒ ุดุฏ!

๐ฐ ูพุงุฏุงุด ุดูุง: ฑฐฐ ุณฺฉู
๐ฅ ุชุนุฏุงุฏ ฺฉู ุฏุนูุชโูุง ุดูุง: X ููุฑ
```

### 5. ูพุงู ุฎูุดโุขูุฏฺฏู ุจูุจูุฏ ุงูุชู

ฺฉุงุฑุจุฑ ุฌุฏุฏ ฺฉู ุจุง ููฺฉ ุฏุนูุช ูุงุฑุฏ ุดุฏูุ ูพุงู ุฒุฑ ุฑุง ูโุจูุฏ:

```
ุซุจุชูุงูุช ุชฺฉูู ุดุฏ! ๐ ุจู ุนููุงู ูุฏู ูุฑูุฏุ ฑฐฐ ุณฺฉู ุจู ฺฉูุช ุงุถุงูู ุดุฏ.

๐ ููฺูู ตฐ ุณฺฉู ุจุงุจุช ุฏุนูุช ุฏูุณุช ุฏุฑุงูุช ฺฉุฑุฏ!

ุญุงูุง ุจุฒู ุจุฑู!
```

### 6. ุชุงุจุน ููุงุด ุขูุงุฑ ุชูุตู

ุชุงุจุน ุฌุฏุฏ `ShowReferralStats` ุจุฑุง ููุงุด ุขูุงุฑ ฺฉุงูู ุฏุนูุชโูุง:

```go
func (h *HandlerManager) ShowReferralStats(userID int64, bot BotInterface)
```

ุงู ุชุงุจุน ููุงุด ูโุฏูุฏ:
- ุชุนุฏุงุฏ ฺฉู ุฏุนูุชโูุง
- ฺฉู ูพุงุฏุงุด ุฏุฑุงูุช
- ูุณุช ฑฐ ููุฑ ุขุฎุฑู ุฏุนูุชโุดุฏฺฏุงู ุจุง ุชุงุฑุฎ ุนุถูุช

## ุจุฑุฑุณ ุงููุช ู ุตุญุช

### โ ฺฺฉโูุง ุงููุช ุงูุฌุงู ุดุฏู:

1. **ุฌููฺฏุฑ ุงุฒ ุฏุนูุช ุฎูุฏ**: ฺฉุงุฑุจุฑ ููโุชูุงูุฏ ุฎูุฏุด ุฑุง ุฏุนูุช ฺฉูุฏ
2. **ุชุงุฏ ูุฌูุฏ ุฏุนูุชโฺฉููุฏู**: ูุจู ุงุฒ ูพุงุฏุงุดุ ูุฌูุฏ ฺฉุงุฑุจุฑ ุฏุนูุชโฺฉููุฏู ุจุฑุฑุณ ูโุดูุฏ
3. **ููุท ุจุฑุง ฺฉุงุฑุจุฑุงู ุฌุฏุฏ**: ูพุงุฏุงุด ููุท ุจุฑุง ุซุจุชโูุงูโูุง ุฌุฏุฏ ุฏุงุฏู ูโุดูุฏ (`isNew` check)
4. **ูุงฺฏ ฺฉุงูู**: ุชูุงู ูุฑุขูุฏ ุฏุนูุช ูุงฺฏ ูโุดูุฏ ุจุฑุง ุจุฑุฑุณ

### โ ููู ฺฉุงูู ุณุณุชู:

1. ฺฉุงุฑุจุฑ A ุฑู ุฏฺฉูู "ุฏุนูุช ุงุฒ ุฏูุณุชุงู" ฺฉูฺฉ ูโฺฉูุฏ
2. ููฺฉ ุงุฎุชุตุงุต `ref_USERID` ููุงุด ุฏุงุฏู ูโุดูุฏ
3. ฺฉุงุฑุจุฑ B ุฑู ููฺฉ ฺฉูฺฉ ูโฺฉูุฏ ู ุซุจุชโูุงู ูโฺฉูุฏ
4. ุณุณุชู `referrer_id` ุฑุง ุฏุฑ session ุฐุฎุฑู ูโฺฉูุฏ
5. ูพุณ ุงุฒ ุชฺฉูู ุซุจุชโูุงู:
   - ฑฐฐ ุณฺฉู ุจู ฺฉุงุฑุจุฑ A ุงุถุงูู ูโุดูุฏ
   - ตฐ ุณฺฉู ุจู ฺฉุงุฑุจุฑ B ุงุถุงูู ูโุดูุฏ
   - ฺฉุงุฑุจุฑ A ููุชูฺฉุดู ุฏุฑุงูุช ูโฺฉูุฏ
   - ฺฉุงุฑุจุฑ B ูพุงู ุฎูุดโุขูุฏฺฏู ุจุง ุฐฺฉุฑ ูพุงุฏุงุด ุฏุฑุงูุช ูโฺฉูุฏ
6. ุชูุงู ุชุฑุงฺฉูุดโูุง ุฏุฑ `coin_transactions` ุซุจุช ูโุดููุฏ

## ูุงูโูุง ุชุบุฑ ุงูุชู

1. `/internal/repositories/user_repository.go`
   - ุงูุฒูุฏู `GetReferralCount()`
   - ุงูุฒูุฏู `GetReferredUsers()`

2. `/internal/handlers/user_handler.go`
   - ุจูุจูุฏ `completeRegistration()` ุจุฑุง ูุฏุฑุช ูพุงุฏุงุดโูุง
   - ุงูุฒูุฏู `ShowReferralStats()`
   - ุจูุจูุฏ ูพุงู ุฎูุดโุขูุฏฺฏู

3. `/telegram/bot.go`
   - ุจูุจูุฏ handler ุฏฺฉูู `BtnReferral`
   - ููุงุด ุขูุงุฑ ุฏุนูุชโูุง

## ุชุณุชโูุง ูพุดููุงุฏ

1. โ Build ูููู
2. โณ ุชุณุช ุฏุนูุช ฺฉุงุฑุจุฑ ุฌุฏุฏ
3. โณ ุชุณุช ุฌููฺฏุฑ ุงุฒ ุฏุนูุช ุฎูุฏ
4. โณ ุชุณุช ููุงุด ุขูุงุฑ
5. โณ ุชุณุช ุงุทูุงุนโุฑุณุงูโูุง

## ูฺฉุงุช ููู

- ูพุงุฏุงุดโูุง ููุท ฺฉ ุจุงุฑ ุฏุฑ ุฒูุงู ุซุจุชโูุงู ุฏุงุฏู ูโุดููุฏ
- ุณุณุชู ุงุฒ `ReferrerID` ุฏุฑ ุฌุฏูู `users` ุจุฑุง ุฑุฏุงุจ ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุชูุงู ุชุฑุงฺฉูุดโูุง ุจุง ููุน `TxTypeReferralReward` ุซุจุช ูโุดููุฏ
- ูุงฺฏโูุง ฺฉุงูู ุจุฑุง debugging ู monitoring
